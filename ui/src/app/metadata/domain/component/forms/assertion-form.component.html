<form [formGroup]="form" role="form">
    <div class="row">
        <fieldset class="col col-xl-6 form-section">
            <p>
                <span translate="label.assertion-consumer-service-endpoints">Assertion Consumer Service Endpoints: </span>
                <button class="btn btn-success btn-sm" (click)="addEndpoint()" translate="action.add-endpoint" aria-label="Add assertion consumer service endpoint to accordion group" role="button">Add Endpoint</button>
            </p>
            <div formArrayName="assertionConsumerServices" class="bg-light border rounded p-4" *ngIf="assertionConsumerServices.length">
                <ul class="list-group" aria-label="Assertion consumer endpoints accordion" tabindex="0" role="presentation">
                    <li *ngFor="let endpoint of assertionConsumerServices.controls; let i=index;"
                        [formGroupName]="i"
                        class="list-group-item"
                        [attr.aria-label]="'Assertion consumer service endpoint accordion item for ' + endpoint.get('locationUrl').value"
                        #acc>
                        <div class="clearfix">
                            <div class="row" (click)="acc.isHidden = !acc.isHidden" (keydown.space)="acc.isHidden = !acc.isHidden" [id]="'ascAccordion' + i" aria-expanded="true" [attr.aria-controls]="'ascContent' + i" role="button">
                                <div class="col-sm-10">
                                    <i class="fa fa-fw" [ngClass]="{'fa-chevron-right': acc.isHidden, 'fa-chevron-down': !acc.isHidden}"></i>
                                    <span tabindex="0" role="heading" aria-level="3">
                                        <ng-container *ngIf="endpoint.get('locationUrl').value">{{ endpoint.get('locationUrl').value }}</ng-container>
                                        <translate *ngIf="!endpoint.get('locationUrl').value" key="label.new-endpoint">New Endpoint</translate>
                                        {{ i }}
                                    </span>
                                    <i class="fa fa-fw fa-check-square fa-lg text-success" aria-hidden="true" *ngIf="endpoint.get('makeDefault').value === true"></i>
                                    <small class="sr-only" *ngIf="endpoint.get('makeDefault').value === true" translate="label.default">(default)</small>
                                </div>
                                <div class="col-sm-2 text-right">
                                    <button class="btn btn-link btn-sm text-danger" (click)="removeEndpoint(i)" aria-label="Delete assertion consumer service endpoint" role="button">
                                        <i class="fa fa-fw fa-trash fa-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="collapse" [ngClass]="{'show': !acc.isHidden}" [id]="'ascContent' + i" [attr.aria-labelledby]="'ascAccordion' + i" role="region">
                            <hr />
                            <div class="form-group">
                                <div class="row">
                                    <label [for]="'location-' + i" class="col-sm-10">
                                        <translate key="label.assertion-consumer-services-location">Assertion Consumer Service Location</translate>
                                    </label>
                                    <span class="col-sm-2 text-right">
                                        <ng-template #tooltipAssertionConsumerServiceLocation>
                                            <translate key="tooltip.assertion-consumer-service-location">Assertion Consumer Service Location popover</translate>
                                        </ng-template>
                                        <i class="info-icon fa fa-fw fa-info-circle text-primary fa-lg"
                                           [ngbPopover]="tooltipAssertionConsumerServiceLocation"
                                           i18n-aria-label="@@tooltip.instruction"
                                           aria-label="Information icon - press spacebar to read additional information for this form field"></i>
                                    </span>
                                </div>
                                <input [id]="'location-' + i" type="text" class="form-control" placeholder="" formControlName="locationUrl" aria-label="Assertion consumer service endpoint location" role="textbox" />
                                <small class="form-text text-danger" *ngIf="endpoint.get('locationUrl').hasError('pattern')">
                                    <translate key="message.valid-url">Must be a valid URL</translate>
                                </small>
                            </div>
                            <div class="row">
                                <div class="col col-8">
                                    <div class="form-group">
                                        <div class="row">
                                            <label [for]="'binding-' + i" class="col-sm-10">
                                                <translate key="label.assertion-consumer-service-location-binding">Assertion Consumer Service Location Binding</translate>
                                            </label>
                                            <span class="col-sm-2 text-right">
                                                <ng-template #tooltipAssertionConsumerServiceLocationBinding>
                                                    <translate key="tooltip.assertion-consumer-service-location-binding">Assertion Consumer Service Location Binding</translate>
                                                </ng-template>
                                            <i class="info-icon fa fa-fw fa-info-circle text-primary fa-lg"
                                               [ngbPopover]="tooltipAssertionConsumerServiceLocationBinding"
                                               i18n-aria-label="@@tooltip.instruction"
                                               aria-label="Information icon - press spacebar to read additional information for this form field"></i>
                                            </span>
                                        </div>
                                        <select [id]="'binding-' + i" class="form-control" formControlName="binding" role="listbox" aria-label="Assertion consumer service location binding type">
                                            <option disabled selected [ngValue]="null" hidden translate="label.select-binding" role="option">Select Binding Type</option>
                                            <option *ngFor="let opt of bindingTypes; let i=index;" [value]="opt" [attr.aria-label]="opt" role="option">
                                                {{ opt }}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-check">
                                        <fieldset aria-label="Mark this assertion consumer service endpoint as the default?">
                                            <label class="d-block">
                                                <translate key="label.mark-as-default">Mark as Default</translate>
                                                <ng-template #tooltipMarkAsDefault>
                                                    <translate key="tooltip.mark-as-default">Mark as Default</translate>
                                                </ng-template>
                                                <i class="info-icon fa fa-fw fa-info-circle text-primary fa-lg"
                                                   [ngbPopover]="tooltipMarkAsDefault"
                                                   i18n-aria-label="@@tooltip.instruction"
                                                   aria-label="Information icon - press spacebar to read additional information for this form field"></i>
                                            </label>
                                            <div class="custom-control custom-checkbox custom-control-inline">
                                                <input type="checkbox"
                                                    id="markAsDefault-{{ i }}"
                                                    class="custom-control-input"
                                                    (click)="markAsDefault(endpoint)"
                                                    [checked]="endpoint.get('makeDefault').value"
                                                    aria-checked="false"
                                                    role="checkbox">
                                                <label class="custom-control-label" for="markAsDefault-{{ i }}" translate="label.yes">Yes</label>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </fieldset>
    </div>
</form>
